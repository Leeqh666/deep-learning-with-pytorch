# 卷积
我们在上一节内容中使用全连接网络模型来对飞机和鸟进行区分。但是这种模型存在着一些问题，比起一般化鸟类和飞机的特征，它更适合记忆训练集。基于我们的模型架构，由于需要完全连接的设置来检测图像中鸟或飞机的各种可能的平移，我们既有太多的参数（使模型更容易过拟合）又没有位置独立性（使其更难概括）

有一个更好的方法是使用卷积来对全连接进行变化。

## 卷积做了什么
我们希望得到的局部化模式对输出产生影响而无论他们处在图像中的任何位置，拥有平移不变性。我们通过卷积核（kernel）来完成这一目标。

假设一个3*3的卷积核：
```python
weight = torch.tensor([[w00, w01, w02],
                       [w10, w11, w12],
                       [w20, w21, w22]])
```
和一个一通道，M×N的图像：
```python
image = torch.tensor([[i00, i01, ...,i0N],
                      [i10, i11, ...,i1N],
                      [i20, i21, ...,i2N],
                      ...,
                      [iM0, iM1, ...,iMN]])
```
我们通过这样的方式来进行计算：
```python
o11 = i11 * w00 + i12 * w01 + i13 * w02 +
      i21 * w10 + i22 * w11 + i23 * w12 +
      i31 * w20 + i32 * w21 + i33 * w22
```
![](https://dpzbhybb2pdcj.cloudfront.net/stevens2/Figures/CH08_F01_Stevens2_GS.png)

## 卷积后图片大小计算
输出图片几种情况下的尺寸计算公式，其中s为步长stride，p的值不固定，只是满足输出和输入尺寸相同情况下的padding值 p= (f-1)/2。

no padding: n - f + 1

padding: n + 2p - f + 1

跳格计算stride with padding: (n + 2p - f)/s + 1(出格时向下取整)

## DOWNSAMPLING
平均池化：
最大池化：
条带卷积：